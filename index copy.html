<!DOCTYPE html>

<html>

  <head>
    <title>Rotate</title>
  </head>

  <body>
    <canvas id="canvas" style="border:1px solid #ccc" width="700" height="500"></canvas>
    <script>
      var canvas = document.getElementById('canvas');
      var context = canvas.getContext('2d');
      var pressingDown = false;
      var pressingUp = false;
      var pressingLeft = false;
      var pressingRight = false;
      var mouseX, mouseY;

      function Player(x, y) {
        this.x = x;
        this.y = y;
        this.angle;
      }

      Player.prototype.draw = function() {
        context.save();
        context.translate(this.x, this.y);
        context.rotate(this.angle);

        context.beginPath();
        context.fillStyle = "green";
        context.arc(0, 0, 30, 0, 2 * Math.PI);
        context.fill();

        context.fillStyle = "red";
        context.fillRect(0, -10, 50, 20);

        context.restore();
      }

      Player.prototype.update = function(mouseX, mouseY) {
        var dx = mouseX - this.x;
        var dy = mouseY - this.y;
        this.angle = Math.atan2(dy, dx);
      }


      canvas.addEventListener('mousemove', mouseMove);


      function mouseMove(evt) {
        mouseX = evt.x;
        mouseY = evt.y;
      }

      var player = new Player(350, 250);


      function updatePlayer() {
        context.clearRect(0, 0, canvas.width, canvas.height);
        player.draw();
        player.update(mouseX, mouseY);
        updatePlayerPosition();
      }

      document.onkeydown = function(event) {
        if (event.keyCode === 83) //s
          pressingDown = true;
        else if (event.keyCode === 87) //w
          pressingUp = true;
        else if (event.keyCode === 65) //a
          pressingLeft = true;
        else if (event.keyCode === 68) //d
          pressingRight = true;
      }

      document.onkeyup = function(event) {
        if (event.keyCode === 83) //s
          pressingDown = false;
        else if (event.keyCode === 87) //w
          pressingUp = false;
        else if (event.keyCode === 65) //a
          pressingLeft = false;
        else if (event.keyCode === 68) //d
          pressingRight = false;
      }

      updatePlayerPosition = function() {
        if (pressingRight)
          player.x += 1;
        if (pressingLeft)
          player.x -= 1;
        if (pressingDown)
          player.y += 1;
        if (pressingUp)
          player.y -= 1;
      }

      function update() {
        updatePlayer();
      }

      setInterval(update, 0)

    </script>
  </body>

</html>
